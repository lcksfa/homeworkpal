# Homework Pal 项目结构重构指南

## 📁 新的目录结构

重构后的项目遵循Python工程最佳实践，具有清晰的模块化结构：

```
homeworkpal/
├── pyproject.toml           # 项目配置和依赖管理
├── README.md               # 项目主文档
├── init.sh                 # 环境初始化脚本
├── run_simple_api.py       # 简化版API入口点
│
├── homeworkpal/           # 主包目录
│   ├── __init__.py        # 包初始化
│   │
│   ├── core/              # 核心业务逻辑
│   │   ├── __init__.py
│   │   ├── config.py      # 配置管理
│   │   └── exceptions.py  # 自定义异常
│   │
│   ├── api/               # FastAPI后端
│   │   ├── __init__.py
│   │   ├── main.py        # 主应用入口
│   │   ├── routes/        # API路由模块
│   │   │   ├── __init__.py
│   │   │   ├── health.py
│   │   │   └── status.py
│   │   └── dependencies.py # FastAPI依赖
│   │
│   ├── frontend/          # Chainlit前端
│   │   ├── __init__.py
│   │   ├── app.py         # Chainlit主应用
│   │   └── handlers/      # 事件处理器
│   │       ├── __init__.py
│   │       ├── chat.py
│   │       └── actions.py
│   │
│   ├── simple/            # 简化版服务
│   │   ├── __init__.py
│   │   ├── api.py         # 简化版API
│   │   └── app.py         # 简化版前端
│   │
│   ├── database/          # 数据库相关
│   │   ├── __init__.py
│   │   ├── models.py      # 数据模型
│   │   └── connection.py  # 数据库连接
│   │
│   ├── llm/              # LLM集成
│   │   ├── __init__.py
│   │   ├── base.py        # 基础LLM接口
│   │   ├── qwen.py        # Qwen模型
│   │   └── deepseek.py    # DeepSeek模型
│   │
│   ├── vision/           # 图像处理
│   │   ├── __init__.py
│   │   └── grading.py    # 图像评分
│   │
│   └── utils/            # 工具函数
│       ├── __init__.py
│       ├── logger.py     # 日志工具
│       └── helpers.py    # 辅助函数
│
├── scripts/              # 脚本目录
│   ├── start_services.sh     # 服务启动脚本
│   ├── test_complete.sh      # 完整测试脚本
│   ├── test_simple.sh        # 简单测试脚本
│   └── test_environment.py   # 环境测试
│
├── tests/               # 测试目录
│   ├── __init__.py
│   ├── conftest.py      # pytest配置
│   ├── test_api/        # API测试
│   ├── test_frontend/   # 前端测试
│   └── test_simple/     # 简化版测试
│
├── docs/               # 文档目录
│   ├── README.md
│   ├── 开发任务分拆.md
│   ├── 环境配置指南.md
│   └── 作业搭子产品文档.md
│
├── data/               # 数据目录
│   └── textbooks/     # 教材数据
│
├── uploads/            # 文件上传目录
├── logs/              # 日志目录
└── vector_index/      # 向量索引目录
```

## 🔄 主要变更

### 1. 包结构重组
- **移除 `src/` 目录**：将 `src/homeworkpal/` 移动到根目录的 `homeworkpal/`
- **模块化设计**：按功能将代码分为多个子模块（`api/`, `frontend/`, `database/`, `llm/`, `vision/`, `utils/`等）
- **简化版服务**：专门创建 `simple/` 子模块用于基础功能验证

### 2. 配置管理
- **集中化配置**：创建 `homeworkpal/core/config.py` 统一管理所有配置
- **环境变量支持**：通过 `python-dotenv` 加载 `.env` 文件
- **类型安全**：使用 Pydantic 风格的配置类

### 3. 脚本重组
- **scripts 目录**：将所有脚本文件移动到 `scripts/` 目录
- **重命名**：`start_simple.sh` → `start_services.sh`
- **路径更新**：所有脚本中的模块引用路径已更新

### 4. 测试结构
- **测试分类**：按模块组织测试文件
- **pytest配置**：添加 `conftest.py` 配置文件
- **简化版测试**：专门的简化版功能测试

## 🚀 使用方法

### 简化版服务启动
```bash
# 方法1：使用脚本（推荐）
./scripts/start_services.sh

# 方法2：使用Python模块
python -m homeworkpal.simple.api

# 方法3：使用入口脚本
python run_simple_api.py
```

### 前端启动
```bash
# 使用脚本
./scripts/start_services.sh  # 自动启动前后端

# 或手动启动
chainlit run homeworkpal.simple.app --host 0.0.0.0 --port 8000
```

### 测试
```bash
# 完整测试
./scripts/test_complete.sh

# 简单测试（需要先启动服务）
./scripts/test_simple.sh

# 环境测试
python scripts/test_environment.py
```

## 📦 包导入示例

### 导入配置
```python
from homeworkpal.core.config import settings
print(f"API Port: {settings.PORT}")
```

### 导入简化版API
```python
from homeworkpal.simple.api import app
```

### 导入工具函数
```python
from homeworkpal.utils.logger import get_logger
from homeworkpal.utils.helpers import format_response
```

## 🧹 清理旧文件

以下文件已被重组，可以安全删除：
- ✅ `main_simple.py` → `homeworkpal/simple/api.py`
- ✅ `app_simple.py` → `homeworkpal/simple/app.py`
- ✅ `start_simple.sh` → `scripts/start_services.sh`
- ✅ `test_complete.sh` → `scripts/test_complete.sh`
- ✅ `test_simple.sh` → `scripts/test_simple.sh`
- ✅ `test_environment.py` → `scripts/test_environment.py`

## ✅ 优势

1. **清晰的模块分离**：不同功能模块独立，便于维护
2. **标准化结构**：符合Python项目的最佳实践
3. **更好的测试组织**：按模块组织测试文件
4. **集中配置管理**：统一的配置系统
5. **简化开发流程**：清晰的入口点和脚本组织
6. **便于扩展**：新功能可以轻松添加到对应模块
7. **更好的IDE支持**：模块化结构提供更好的代码导航和自动完成

## 🔧 开发建议

1. **新功能开发**：根据功能类型在对应模块下创建文件
2. **配置修改**：在 `homeworkpal/core/config.py` 中添加新的配置项
3. **测试编写**：在 `tests/` 目录下创建对应的测试文件
4. **脚本添加**：将新脚本放在 `scripts/` 目录下
5. **文档更新**：项目文档放在 `docs/` 目录下

这个新的结构为项目的长期维护和扩展提供了坚实的基础。

## 🌐 URL访问指南

### 正确的访问地址

#### 浏览器访问
- **前端界面**: `http://localhost:8000` ✅
- **后端API**: `http://localhost:8001` ✅
- **API文档**: `http://localhost:8001/docs` ✅

#### 服务器配置
- **前端启动**: `--host 0.0.0.0 --port 8000`
- **后端启动**: `--host 0.0.0.0 --port 8001`

### 关键概念说明

#### `0.0.0.0` vs `localhost`

| 用途 | 地址 | 说明 |
|------|------|------|
| **服务器启动** | `0.0.0.0` | 监听所有网络接口，允许外部访问 |
| **浏览器访问** | `localhost` | 本地访问的正确地址 |
| **浏览器访问** | `127.0.0.1` | localhost的IP地址形式 |

### 为什么这样设计？

1. **`0.0.0.0` (服务器)**：
   - 让服务监听所有可用的网络接口
   - 支持从不同IP地址访问（不仅仅是localhost）
   - 在Docker容器或远程服务器部署时很有用

2. **`localhost` (浏览器)**：
   - 浏览器访问本地服务的标准方式
   - 比 `0.0.0.0` 更用户友好
   - 避免浏览器的网络限制

### 常见错误

#### ❌ 错误做法
```
在浏览器中访问：http://0.0.0.0:8000
```
**结果**：浏览器无法解析 `0.0.0.0` 地址

#### ✅ 正确做法
```
在浏览器中访问：http://localhost:8000
或：http://127.0.0.1:8000
```
**结果**：正常访问前端界面

### 验证方法

启动服务后，运行：
```bash
./scripts/test_simple.sh
```

如果看到所有测试通过，说明URL配置正确。