# 作业搭子环境配置指南

## 快速开始

### 1. 创建环境配置文件

```bash
# 复制模板文件创建实际配置
cp .env.template .env
```

### 2. 编辑配置文件

编辑 `.env` 文件，填入你的实际配置值：

```bash
# 使用你喜欢的编辑器
nano .env
# 或者
vim .env
# 或者
code .env
```

## 必需配置项

### AI模型API密钥（至少配置一个）

**推荐使用国产大模型以获得更好的中文支持：**

```bash
# 阿里云通义千问（推荐）
DASHSCOPE_API_KEY=你的实际API密钥

# DeepSeek模型（推荐）
DEEPSEEK_API_KEY=你的实际API密钥
```

**备选方案：**

```bash
# OpenAI（备用）
OPENAI_API_KEY=你的实际API密钥
```

### 数据库连接

```bash
# 如果使用init.sh启动的PostgreSQL容器，默认配置通常有效
DATABASE_URL=postgresql://homeworkpal:password@localhost:5432/homeworkpal
```

## API密钥获取指南

### 阿里云DashScope (通义千问)

1. 访问 [阿里云机器学习平台PAI](https://www.aliyun.com/product/bigdata/learn)
2. 注册并登录阿里云账号
3. 开通DashScope服务
4. 在控制台获取API Key

### DeepSeek

1. 访问 [DeepSeek官方网站](https://platform.deepseek.com/)
2. 注册并登录账号
3. 在控制台获取API Key

### OpenAI

1. 访问 [OpenAI官方网站](https://platform.openai.com/)
2. 注册并登录账号
3. 在API Keys页面创建新的API Key

## 可选配置项

### Redis缓存（提升性能）

```bash
# 如果使用Redis缓存
REDIS_URL=redis://localhost:6379/0
ENABLE_CACHE=true
```

### 日志级别

```bash
# 开发环境
LOG_LEVEL=DEBUG

# 生产环境
LOG_LEVEL=WARNING
```

### 文件存储路径

```bash
# 自定义存储目录
UPLOAD_DIR=/path/to/your/uploads
TEXTBOOK_DIR=/path/to/your/textbooks
LOG_DIR=/path/to/your/logs
```

## 配置验证

完成配置后，运行初始化脚本验证：

```bash
./init.sh
```

如果配置正确，你将看到：
- ✅ 环境文件加载成功
- ✅ 数据库连接成功
- ✅ 所有服务正常启动

## 常见问题

### 问题1：API密钥无效

**错误信息**: `Authentication failed`
**解决方案**: 检查API密钥是否正确，是否有足够的配额

### 问题2：数据库连接失败

**错误信息**: `Connection to database failed`
**解决方案**:
1. 检查PostgreSQL是否运行
2. 验证数据库连接参数
3. 确保pgvector扩展已启用

### 问题3：端口冲突

**错误信息**: `Port already in use`
**解决方案**:
1. 修改配置文件中的端口号
2. 或者停止占用端口的服务

### 问题4：权限问题

**错误信息**: `Permission denied`
**解决方案**:
1. 确保脚本有执行权限：`chmod +x init.sh`
2. 检查目录写入权限

## 安全建议

### 1. 保护敏感信息

```bash
# 确保环境文件不被提交到版本控制
echo ".env" >> .gitignore

# 设置文件权限
chmod 600 .env
```

### 2. 使用强密码

```bash
# 数据库密码
DB_PASSWORD=your_strong_password_here

# JWT密钥
JWT_SECRET=your_jwt_secret_key_here
```

### 3. 定期轮换API密钥

- 建议每3个月更换一次API密钥
- 使用密钥管理服务存储敏感信息

## 生产环境配置

在生产环境中，建议调整以下配置：

```bash
# 环境类型
ENVIRONMENT=production
DEBUG=false

# 日志级别
LOG_LEVEL=WARNING

# 安全设置
CORS_ORIGINS=https://yourdomain.com
HTTPS=true
SSL_CERT_PATH=/path/to/cert.pem
SSL_KEY_PATH=/path/to/key.pem

# 性能优化
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
ENABLE_CACHE=true
```

## 下一步

完成环境配置后，请参考以下文档：

- [开发指南](../README.md) - 了解项目结构和开发流程
- [API文档](../docs/API文档.md) - 了解可用的API接口
- [部署指南](../docs/部署指南.md) - 了解如何部署到生产环境

## 技术支持

如果遇到问题，请：

1. 查看日志文件：`tail -f logs/app.log`
2. 检查配置：`./init.sh --help`
3. 提交Issue到项目仓库

---

**注意**: 请确保所有配置项都已正确填写后再运行应用程序。错误的配置可能导致应用程序无法正常工作。