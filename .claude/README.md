# Claude Code 通用配置

基于长期运行代理方法论构建的RAG（检索增强生成）智能问答系统Claude Code开发环境配置。

## 配置概览

本配置实现了"把工程纪律植入 AI：拆解、留痕、自证、可回滚，小步快跑到可交付"的核心理念，为RAG项目提供：

- ✅ **可恢复的工程环境**：一键启动的开发环境配置
- ✅ **严格的功能治理**：端到端功能清单管理
- ✅ **渐进式开发流程**：每次会话专注一个功能
- ✅ **完整的质量保证**：E2E测试和回滚机制
- ✅ **中文本土化支持**：地道、无歧义的中文指令和文档

## 目录结构

```
.claude/
├── agents/           # 可复用的专业代理
│   ├── rag初始化代理.md
│   ├── rag编码代理.md
│   └── rag测试代理.md
├── skills/           # 工程护栏能力
│   ├── rag-init-script-runner/
│   ├── rag-feature-governor/
│   ├── rag-progress-logger/
│   ├── rag-e2e-smoke/
│   ├── rag-browser-flow/
│   ├── rag-git-ops/
│   ├── rag-rollback/
│   └── rag-commit-helper/
├── commands/         # 中文斜杠命令
│   ├── rag初始化.md
│   ├── rag开发会话.md
│   ├── rag功能验证.md
│   ├── rag状态报告.md
│   ├── rag回滚恢复.md
│   └── rag文档管理.md
└── README.md         # 本文档
```

## 核心设计理念

### 1. 拆解：化繁为简
将复杂的RAG系统拆解为明确的功能清单，每个功能包含：
- 清晰的用户场景描述
- 详细的验证步骤
- 明确的通过标准
- 严格的治理规则

### 2. 留痕：全程可追溯
每次会话都必须留下结构化记录：
- `claude-progress.txt`：会话进展日志
- Git提交记录：原子化的变更历史
- 测试证据：E2E验证的截图和日志
- 性能指标：系统质量的量化数据

### 3. 自证：用户视角验证
强制要求以用户视角进行端到端测试：
- 浏览器自动化测试
- 完整用户旅程模拟
- 真实场景下的功能验证
- 客观的质量评估标准

### 4. 可回滚：安全保护机制
确保所有变更可快速回滚：
- 最小化变更范围
- 原子化提交策略
- 快速恢复流程
- 事故记录和预防机制

## 快速开始

### 首次项目初始化
```bash
# 使用初始化代理搭建项目环境
/rag初始化
```

### 日常开发会话
```bash
# 启动标准开发会话
/rag开发会话

# 验证已完成的功能
/rag功能验证 RAG-001

# 查看项目状态
/rag状态报告
```

### 文档和测试管理
```bash
# 管理RAG系统的文档资源
/rag文档管理 upload ./docs/技术文档.pdf

# 系统回滚和恢复
/rag回滚恢复 safe
```

## RAG功能开发流程

### 文档处理功能开发
1. **文档上传**：支持PDF、TXT、MD、DOCX等格式
2. **内容解析**：提取文本、图片、表格等元素
3. **智能分段**：基于语义和结构的文档分割
4. **向量化处理**：转换为高质量的向量表示
5. **索引建立**：构建高效的检索索引

### 检索功能开发
1. **查询理解**：分析用户意图和查询类型
2. **向量搜索**：基于语义相似度的文档检索
3. **结果排序**：多维度相关性排序算法
4. **上下文过滤**：根据对话历史调整检索
5. **结果优化**：去重、多样性、实时性处理

### 生成功能开发
1. **上下文构建**：组织检索到的相关信息
2. **回答生成**：基于LLM的智能回答生成
3. **引用标注**：准确标注信息来源
4. **质量控制**：确保回答的准确性和相关性
5. **用户交互**：友好的回答展示和交互

## 工程护栏说明

### Skills（工程能力）
- **rag-init-script-runner**：环境初始化和启动
- **rag-feature-governor**：功能清单治理
- **rag-progress-logger**：进展记录和追踪
- **rag-e2e-smoke**：系统健康检查
- **rag-browser-flow**：用户旅程测试
- **rag-git-ops**：Git操作规范
- **rag-rollback**：回滚和恢复
- **rag-commit-helper**：提交信息生成

### Agents（专业代理）
- **rag初始化代理**：项目首次搭建和环境配置
- **rag编码代理**：功能实现和增量开发
- **rag测试代理**：质量保证和测试验证

### Commands（快捷命令）
- **/rag初始化**：项目初始化
- **/rag开发会话**：启动开发流程
- **/rag功能验证**：验证指定功能
- **/rag状态报告**：生成项目报告
- **/rag回滚恢复**：系统恢复
- **/rag文档管理**：文档资源管理

## 开发规范

### 会话启动仪式
每个开发会话必须遵循标准流程：
1. `pwd` → 确认工作目录
2. `git log` → 查看变更历史
3. `claude-progress.txt` → 阅读进展记录
4. `./init.sh` → 启动开发环境
5. `E2E冒烟测试` → 验证系统健康
6. 选择目标功能 → 开始开发

### 功能实现原则
- **单次一事**：每次会话只实现一个功能
- **最小变更**：保持改动范围可控
- **用户验证**：必须通过E2E测试
- **干净收尾**：完整记录和提交

### 质量标准
- 所有功能必须通过浏览器自动化测试
- 代码变更必须有对应的测试覆盖
- 提交信息必须包含详细的变更说明
- 进展记录必须包含充分的上下文信息

## 监控和维护

### 质量指标监控
- 文档处理成功率 > 95%
- 检索响应时间 < 500ms
- 生成回答相关性 > 85%
- 端到端响应时间 < 2秒

### 定期维护任务
- 每周执行完整功能回归测试
- 每月更新功能清单和测试用例
- 每季度评估和优化开发流程
- 持续改进工程护栏配置

## 最佳实践

### 开发效率提升
- 预先准备测试数据和场景
- 建立标准化的开发环境配置
- 使用模板化的功能描述和测试步骤
- 维护可复用的代码片段和工具

### 质量保证强化
- 严格执行E2E测试要求
- 定期进行代码审查和重构
- 建立自动化测试流水线
- 持续收集和分析用户反馈

### 团队协作优化
- 统一开发流程和规范
- 建立知识共享机制
- 定期进行技术分享和培训
- 维护项目文档和最佳实践指南

## 故障排除

### 常见问题解决
1. **环境启动失败**：检查Python版本和依赖配置
2. **向量数据库连接问题**：验证数据库服务状态和配置
3. **文档处理异常**：检查文件格式和权限设置
4. **检索结果质量差**：调优向量化参数和分段策略
5. **生成回答不准确**：优化Prompt模板和上下文管理

### 紧急恢复流程
1. 使用`/rag回滚恢复`快速恢复到稳定状态
2. 分析问题根本原因并记录
3. 修复问题后重新验证系统
4. 更新预防措施和检查清单

## 技术支持

### 文档资源
- 项目根目录的中文方法论文档
- `.claude/`目录下的配置文件说明
- Git提交历史中的详细变更记录
- `claude-progress.txt`中的进展和问题记录

### 社区支持
- 查看相关Issues和讨论
- 参与代码审查和建议
- 分享使用经验和最佳实践
- 贡献改进和扩展功能

---

**本项目基于"长期Vibe coding的Agent运行方法论"构建，实现了AI编程的工程化、系统化和可持续化。通过严格的工程护栏和标准化的开发流程，确保RAG系统的质量和可靠性。**